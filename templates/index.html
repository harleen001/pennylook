<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ledgr Pro | Finance Insights</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        :root { --sidebar-w: 280px; --primary: #4f46e5; }
        body { background-color: #f8fafc; font-family: 'Inter', system-ui, sans-serif; }
        .sidebar { width: var(--sidebar-w); position: fixed; height: 100vh; background: #fff; border-right: 1px solid #e2e8f0; padding: 2.5rem 1.5rem; }
        .content { margin-left: var(--sidebar-w); padding: 3rem; }
        .card { border: none; border-radius: 20px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.05); transition: 0.3s; }
        .stat-card { border-left: 5px solid var(--primary); }
        .badge-debit { background: #fee2e2; color: #dc2626; font-weight: 600; }
        .badge-credit { background: #dcfce7; color: #16a34a; font-weight: 600; }
        .table thead { background: #f8fafc; text-uppercase: uppercase; font-size: 0.75rem; letter-spacing: 0.05em; }
    </style>
</head>
<body>

<div class="sidebar d-flex flex-column">
    <h2 class="fw-bold mb-5">Ledgr<span class="text-primary">.</span></h2>
    
    <label class="small fw-bold text-muted mb-2">TIME PERIOD</label>
    <form action="/" method="get" class="mb-4">
        <select name="month" class="form-select border-0 bg-light rounded-3 shadow-sm" onchange="this.form.submit()">
            <option value="All">All Statements</option>
            {% for m in months %}
            <option value="{{ m }}" {% if selected_month == m %}selected{% endif %}>{{ m }}</option>
            {% endfor %}
        </select>
    </form>

    <div class="mt-auto">
        <a href="/sync" class="btn btn-primary w-100 py-3 rounded-4 fw-bold shadow">ðŸ”„ Sync Last 10 Months</a>
    </div>
</div>

<div class="content">
    <div class="row g-4 mb-5">
        <div class="col-md-6">
            <div class="card p-4 border-start border-success border-5 shadow-sm">
                <small class="text-muted fw-bold">TOTAL DEPOSITS</small>
                <h2 class="text-success fw-bold mb-0">â‚¹{{ "{:,.2f}".format(summary.income or 0) }}</h2>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card p-4 border-start border-danger border-5 shadow-sm">
                <small class="text-muted fw-bold">TOTAL WITHDRAWALS</small>
                <h2 class="text-danger fw-bold mb-0">â‚¹{{ "{:,.2f}".format(summary.expense or 0) }}</h2>
            </div>
        </div>
    </div>

    <div class="card p-4 mb-5">
        <div class="d-flex justify-content-between mb-4">
            <h5 class="fw-bold mb-0">Cash Flow Visualization</h5>
            <span class="badge bg-primary-subtle text-primary px-3 rounded-pill">{{ selected_month }}</span>
        </div>
        <div id="main-viz" data-graph='{{ graph_json | safe if graph_json else "{}" }}' style="height: 450px;"></div>
    </div>

    <div class="card overflow-hidden">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead>
                    <tr>
                        <th class="ps-4 py-3">Date</th>
                        <th class="py-3">Narration</th>
                        <th class="py-3">Amount</th>
                        <th class="py-3 text-center">Type</th>
                    </tr>
                </thead>
                <tbody>
                    {% for t in transactions %}
                    <tr>
                        <td class="ps-4 text-muted small">{{ t.date }}</td>
                        <td class="fw-medium small" title="{{ t.description }}">{{ t.description[:65] }}{% if t.description|length > 65 %}...{% endif %}</td>
                        <td class="fw-bold {% if t.type == 'Debit' %}text-danger{% else %}text-success{% endif %}">
                            {{ "-" if t.type == 'Debit' else "+" }} â‚¹{{ "{:,.2f}".format(t.amount) }}
                        </td>
                        <td class="text-center">
                            <span class="badge rounded-pill px-3 py-2 {% if t.type == 'Debit' %}badge-debit{% else %}badge-credit{% endif %}">
                                {{ t.type }}
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const vizElement = document.getElementById('main-viz');
        const config = JSON.parse(vizElement.getAttribute('data-graph'));
        if (config && config.data) {
            Plotly.newPlot('main-viz', config.data, config.layout, {
                responsive: true,
                displaylogo: false,
                modeBarButtonsToRemove: ['lasso2d', 'select2d']
            });
        } else {
            vizElement.innerHTML = "<div class='text-center py-5 text-muted'>Sync your emails to visualize data.</div>";
        }
    });
</script>

</body>
</html>